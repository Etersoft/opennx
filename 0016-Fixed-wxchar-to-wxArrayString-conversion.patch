From 9bc8f6df96781b8bb284b7803cdb171a6762cf58 Mon Sep 17 00:00:00 2001
From: Sergey Bolotov <sbol@etersoft.ru>
Date: Mon, 27 Jul 2015 16:32:51 +0300
Subject: [PATCH 16/22] Fixed wxchar** to wxArrayString conversion
To: wine-patches <wine-patches@winehq.org>
Reply-To: wine-devel <wine-devel@winehq.org>

---
 opennx/opennxApp.cpp      | 12 ++++++++++--
 opennx/watchReaderApp.cpp | 11 +++++++++--
 2 files changed, 19 insertions(+), 4 deletions(-)

diff --git a/opennx/opennxApp.cpp b/opennx/opennxApp.cpp
index 2c320ab..e4d82fa 100644
--- a/opennx/opennxApp.cpp
+++ b/opennx/opennxApp.cpp
@@ -864,7 +864,15 @@ void opennxApp::OnInitCmdLine(wxCmdLineParser& parser)
     // On Unix, --display is a toolkit option
     wxRegEx re(wxT("^--((exportres)|(cacert)|(caption)|(style)|(dialog)|(message)|(parent)|(session)|(window)|(trace))$"));
 #endif
-    wxArrayString as(argc, (const wxChar **)argv);
+    //  wxWidgets > 3.0
+    wxArrayString as;
+    for(int i = 0; i < argc; i++)
+    {
+        wxString str(argv[i]);
+        as.Add(str);
+    }
+    //  end wxWidgets > 3.0
+
     for (i = 1; i < as.GetCount(); i++) {
         if (re.Matches(as[i])) {
             if ((i + 1) < as.GetCount()) {
@@ -875,7 +883,7 @@ void opennxApp::OnInitCmdLine(wxCmdLineParser& parser)
     }
     wxChar **xargv = new wxChar* [as.GetCount()];
     for (i = 0; i < as.GetCount(); i++)
-        xargv[i] = wxStrdup(as[i].c_str());
+        xargv[i] = wxStrdup(as[i].wc_str());
     parser.SetCmdLine(as.GetCount(), xargv);
 
 }
diff --git a/opennx/watchReaderApp.cpp b/opennx/watchReaderApp.cpp
index 3febf56..8ce8eef 100644
--- a/opennx/watchReaderApp.cpp
+++ b/opennx/watchReaderApp.cpp
@@ -141,7 +141,14 @@ void watchReaderApp::OnInitCmdLine(wxCmdLineParser& parser)
     // On Unix, --display is a toolkit option
     wxRegEx re(wxT("^--((reader)|(pid)|(trace))$"));
 #endif
-    wxArrayString as(argc, (const wxChar **)argv);
+    //  wxWidgets > 3.0
+    wxArrayString as;
+    for(int i = 0; i < argc; i++)
+    {
+        wxString str(argv[i]);
+        as.Add(str);
+    }
+    //  end wxWidgets > 3.0
     for (i = 1; i < as.GetCount(); i++) {
         if (re.Matches(as[i])) {
             if ((i + 1) < as.GetCount()) {
@@ -152,7 +159,7 @@ void watchReaderApp::OnInitCmdLine(wxCmdLineParser& parser)
     }
     wxChar **xargv = new wxChar* [as.GetCount()];
     for (i = 0; i < as.GetCount(); i++)
-        xargv[i] = wxStrdup(as[i].c_str());
+        xargv[i] = wxStrdup(as[i].wc_str());
     parser.SetCmdLine(as.GetCount(), xargv);
 }
 
-- 
2.1.4

