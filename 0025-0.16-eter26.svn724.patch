From fbc86e60b0c2a973e1e63dc72ec23e1d2567e79f Mon Sep 17 00:00:00 2001
From: Vitaly Lipatov <lav@etersoft.ru>
Date: Sun, 26 Jan 2014 19:53:36 +0400
Subject: [PATCH 25/37] 0.16-eter26.svn724

- fix build with libsmbclient from samba 4.0, fix symlink to libsmbclient
---
 .gear/opennx.spec   | 8 ++++++--
 opennx/configure    | 2 +-
 opennx/configure.ac | 2 +-
 3 files changed, 8 insertions(+), 4 deletions(-)

diff --git a/.gear/opennx.spec b/.gear/opennx.spec
index 3d71a97..bfa1c70 100644
--- a/.gear/opennx.spec
+++ b/.gear/opennx.spec
@@ -3,7 +3,7 @@
 
 Name: opennx
 Version: 0.16
-Release: eter25.svn724
+Release: eter26.svn724
 
 Summary: An OpenSource NX client
 
@@ -60,7 +60,8 @@ done
 mkdir -p %buildroot%_libdir/%name/%_lib
 
 for lib in libsmbclient.so libcups.so ; do
-    ln -s %_libdir/`readlink %_libdir/$lib` %buildroot%_libdir/%name/%_lib/$lib
+    test -r %_libdir/$lib.? || exit
+    ln -s %_libdir/$lib.? %buildroot%_libdir/%name/%_lib/$lib
 done
 
 cp %buildroot%_datadir/%name/applnk/xdg/*.desktop %buildroot%_desktopdir
@@ -106,6 +107,9 @@ install -m 644 etc/*.rules %buildroot%_sysconfdir/udev/rules.d
 %endif
 
 %changelog
+* Sun Jan 26 2014 Vitaly Lipatov <lav@altlinux.ru> 0.16-eter26.svn724
+- fix build with libsmbclient from samba 4.0, fix symlink to libsmbclient
+
 * Thu Oct 03 2013 Vitaly Lipatov <lav@altlinux.ru> 0.16-eter25.svn724
 - remove PidFile option from cups config (eterbug #9490)
 
diff --git a/opennx/configure b/opennx/configure
index 80a4342..f1117b7 100755
--- a/opennx/configure
+++ b/opennx/configure
@@ -20575,7 +20575,7 @@ FULLVERSION=$_ver
 
 
 
-for ac_header in cups/cups.h cups.h libsmbclient.h usb.h
+for ac_header in cups/cups.h cups.h samba-4.0/libsmbclient.h libsmbclient.h usb.h
 do :
   as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
 ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
diff --git a/opennx/configure.ac b/opennx/configure.ac
index 41a9ffe..dd729e0 100644
--- a/opennx/configure.ac
+++ b/opennx/configure.ac
@@ -452,7 +452,7 @@ FE_SVNREV([SVNREV])
 AC_DEFINE_UNQUOTED(SVNREV,"$SVNREV",[SVN revision])
 FE_RCVERSION
 
-AC_CHECK_HEADERS([cups/cups.h cups.h libsmbclient.h usb.h])
+AC_CHECK_HEADERS([cups/cups.h cups.h samba-4.0/libsmbclient.h libsmbclient.h usb.h])
 
 if test "$ac_cv_enable_usbip" = "YES" -a "$ac_cv_header_usb_h" != "yes"; then
     AC_MSG_ERROR([Need usb.h when compiling with usbip support])
-- 
2.1.4

