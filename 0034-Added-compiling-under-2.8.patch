From aca010a77974aa90e49d12a091ab76285ec6c85a Mon Sep 17 00:00:00 2001
From: Sergey Bolotov <sbol@etersoft.ru>
Date: Thu, 30 Jul 2015 18:29:10 +0300
Subject: [PATCH 34/34] Added compiling under 2.8

---
 opennx/LoginDialog.cpp | 4 ++--
 opennx/MySession.h     | 4 ++--
 opennx/MyXmlConfig.cpp | 4 ++++
 opennx/TextViewer.cpp  | 4 ++++
 opennx/mylog.cpp       | 2 +-
 opennx/pwcrypt.cpp     | 8 ++++++++
 6 files changed, 21 insertions(+), 5 deletions(-)

diff --git a/opennx/LoginDialog.cpp b/opennx/LoginDialog.cpp
index ac93a5e..9d7fdd7 100644
--- a/opennx/LoginDialog.cpp
+++ b/opennx/LoginDialog.cpp
@@ -192,7 +192,7 @@ void LoginDialog::ReadConfigDirectory()
     for (i = 0; i < m_aConfigFiles.GetCount(); i++) {
         MyXmlConfig cfg(m_aConfigFiles[i]);
         if (cfg.IsValid()) {
-            m_pCtrlSessionName->Append(cfg.sGetName(), const_cast<char *>(m_aConfigFiles[i].c_str().AsChar()));
+            m_pCtrlSessionName->Append(cfg.sGetName(), const_cast<char*>(to_c_str(m_aConfigFiles[i])));
             if ((cfg.sGetFileName() == m_sLastSessionFilename) ||
                     (cfg.sGetName() == m_sLastSessionFilename)) {
                 m_pCurrentCfg = new MyXmlConfig(m_aConfigFiles[i]);
@@ -399,7 +399,7 @@ void LoginDialog::OnButtonWizardClick( wxCommandEvent& event )
 	ReadConfigDirectory();
 	m_sSessionName = wz.sGetConfigName();
 	MyXmlConfig cfg(m_sSessionName);
-    m_pCtrlSessionName->Append(cfg.sGetName(), const_cast<char *>(m_sSessionName.c_str().AsChar()));
+    m_pCtrlSessionName->Append(cfg.sGetName(), const_cast<char*>(to_c_str(m_sSessionName)));
     m_pCtrlSessionName->SetStringSelection(cfg.sGetName());
     wxCommandEvent event2;
     OnComboboxSessionSelected(event2);
diff --git a/opennx/MySession.h b/opennx/MySession.h
index ad73a55..9955a7e 100644
--- a/opennx/MySession.h
+++ b/opennx/MySession.h
@@ -27,11 +27,11 @@
 
 #include "MyXmlConfig.h"
 
-//  wxWidgets lib > 3.0
+#if wxCHECK_VERSION(2,9,0)
 #define wxHTTP_Req wxString
 #define wxHTTP_GET wxString("GET")
 #define wxHTTP_POST wxString("POST")
-//  end wxWidgets lib > 3.0
+#endif
 
 class ConnectDialog;
 class MyIPC;
diff --git a/opennx/MyXmlConfig.cpp b/opennx/MyXmlConfig.cpp
index 6fbd465..ad4bf84 100644
--- a/opennx/MyXmlConfig.cpp
+++ b/opennx/MyXmlConfig.cpp
@@ -557,7 +557,11 @@ MyXmlConfig::UrlEsc(const wxString &s)
     size_t len = s.Length();
     wxString ret;
     for (size_t i = 0; i < len; i++) {
+#if wxCHECK_VERSION(2,9,0)
         switch (s[i].GetValue()) {
+#else
+        switch (s[i]) {
+#endif
             case wxT(' '):
             case wxT(':'):
             case wxT('"'):
diff --git a/opennx/TextViewer.cpp b/opennx/TextViewer.cpp
index b439d58..6fd0271 100644
--- a/opennx/TextViewer.cpp
+++ b/opennx/TextViewer.cpp
@@ -56,7 +56,11 @@ DECLARE_DYNAMIC_CLASS(myRichTextCtrl);
 
     public:
 
+#if wxCHECK_VERSION(2,9,0)
     bool DoLoadFile(const wxString& filename, wxRichTextFileType fileType = wxRICHTEXT_TYPE_XML)
+#else
+    bool DoLoadFile(const wxString& filename, int fileType = wxRICHTEXT_TYPE_XML)
+#endif
     {
         bool success = false;
         wxFileSystem fs;
diff --git a/opennx/mylog.cpp b/opennx/mylog.cpp
index 24c0e0d..f21d06b 100644
--- a/opennx/mylog.cpp
+++ b/opennx/mylog.cpp
@@ -105,6 +105,6 @@ const char* to_c_str(wxString str)
 #if wxCHECK_VERSION(2,9,0)
 	return str.c_str().AsChar();
 #else
-	return str.c_str();
+	return str.mb_str();
 #endif
 }
diff --git a/opennx/pwcrypt.cpp b/opennx/pwcrypt.cpp
index 7756ada..9b8b475 100644
--- a/opennx/pwcrypt.cpp
+++ b/opennx/pwcrypt.cpp
@@ -47,7 +47,11 @@ encodeString(const wxString &s)
     if (s.Length()) {
         ret = wxT(":");
         for (i = 0; i < s.Length(); i++)
+#if wxCHECK_VERSION(2,9,0)
             ret += wxString::Format(wxT("%d:"), s[i].GetValue() + i + 1);
+#else
+            ret += wxString::Format(wxT("%d:"), s[i] + i + 1);
+#endif
     }
     return ret;
 }
@@ -125,7 +129,11 @@ decryptString(const wxString &s)
     sRet = s;
     sRet.Truncate(s.Length() - 1);
     
+#if wxCHECK_VERSION(2,9,0)
     int n = (sRet[0].GetValue() + sRet.Length()) - 3;
+#else
+    int n = (sRet[0] + sRet.Length()) - 3;
+#endif
     
     for (i = 1; i < sRet.Length(); i++) {
         int j = validChars.Find(sRet[i]);
-- 
2.1.4

